### 쿠키 (Cookie) (= HTTP 쿠키, 웹 쿠키, 브라우저 쿠키)

---

- 서버가 클라이언트 (브라우저)에게 전송하는 작은 정보

- stateless (상태가 없는) HTTP에서 브라우저는 쿠키 정보를 저장해 동일한 서버에 재요청 할 경우 저장된 쿠키 정보를 같이 실어 보냄

- 쿠키는 공개된 정보이기 때문에 보안에 취약함

- 이름-값 쌍의 형태로 정보를 기록하며 쿠키 만료 기간 및 도메인, Secure, HttpOnly 등의 정보를 가짐

- 쿠키 생성

  - 서버에서 전송된 응답에서 Set-Cookie 헤더로 쿠키를 만듬

  - 응답을 통해 얻은 속성도 생성하여 저장

  - 쿠키를 생성한 이후 부터는 서버로 전송되는 요청에 쿠키 값을 실어 보냄

- 쿠키 속성

  - 삭제 : 쿠키는 세션이 종료될 때 삭제되며, 만약 Expires 속성에 날짜가 적혀 있거나 Max-age 속성에 기간이 적혀있다면 그 기간 이후에 삭제됨

  - 스코프

    - Domain 속성 : 쿠키에 접근할 수 있는 도메인

    - Path 속성 : 쿠키에 접근할 수 있는 url 경로

  - Secure 속성 : Https로 통신하는 경우만 쿠키가 전송됨 (Https에서 설정한 쿠키에 Http는 접근 불가능)
  - HttpOnly : 클라이언트 측에서 자바스크립트를 사용해 쿠키에 접근하는 것을 막음 (쿠키를 보호하고 싶은 경우 해당 속성 사용)

- `document.cookie`

  - 현재 접속한 사이트에 관한 쿠키 정보 알 수 있음

  - 이름=값 쌍 형태

  - 브라우저에 따라 허용되는 쿠키 개수는 20개 내외

- **CORS** (교차 출처 리소스 공유)

  - 동일 출처 : 두 url의 프로토콜 + 포트 + 호스트 모두가 같은 경우

  - 동일 출처 정책 : 한 출처에서 로드된 자원들을 다른 출처의 자원들과 상호작용하는 것을 제한

  - 최근에는 거의 클라이언트와 api 서버를 분리하여 작업하고 있기 때문에 동일 출처 정책으로인한 에러를 많이 마주치게 되었고, 이러한 문제를 해결할 수 있도록 허용된 출처를 서버에 알려주는 HTTP 헤더가 등장함

    => CORS = HTTP 헤더를 이용해서 다른 출처에 있는 리소스에 접근할 수 있도록 권한을 부여

  - CORS 동작

    - 요청을 보낸 헤더의 origin 필드와 서버가 보내준 Access-Control-Allow-Origin 값을 비교해 브라우저에서 응답이 유효한지 판단

    - 유효하지 않으면 에러 처리

    - 만약 서버가 해당 요청 허용할 경우 응답 헤더의 Access-Control-Allow-Methods 필드에 허용하는 메서드가 나타남

  - CORS 동작 시나리오

    - 사전 요청 방식이 대표적

    - OPTIONS 메서드를 사용해 실제 요청 전송 전, 요청에 대한 허가를 받은 후 요청을 보내는 방식 (일반적으로 브라우저에서 자동으로 전송)

  - fetch() 같이 브라우저에서 제공하는 방식은 서로의 출처가 다른 경우 브라우저의 쿠키 또는 인증 정보를 헤더에 담지 않음

    - 인증 정보를 담고 싶다면 credentials 옵션 변경 (XMLHttpRequest의 경우에는 withCredential 옵션)

    - credentials 옵션

      - same-origin : 동일 출처일 경우 보냄 (default)

      - omit : 항상 쿠키 전송 안함

      - include : 교차 출처라고 하더라도 보냄 (이 경우 서버에서 Access-Control-Allow-Origin에 명확한 url 입력해야 오류 안남)
